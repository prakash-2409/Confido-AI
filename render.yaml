# ================================================================
# Render Cloud Deployment Configuration
# ================================================================
# Deploy to Render in minutes:
#   1. Push this repo to GitHub
#   2. Go to https://render.com and create a new Web Service
#   3. Connect your GitHub repo — Render detects this render.yaml
#   4. Click "Apply" to create all services at once (Blueprint)
#   5. Set secret environment variables in the Render dashboard
# ================================================================

services:
  # ----------------------------------------------------------------
  # Backend (Node.js / Express)
  # ----------------------------------------------------------------
  - type: web
    name: career-ai-backend
    runtime: docker
    dockerfilePath: ./backend/Dockerfile
    dockerContext: ./backend
    plan: free              # upgrade to starter/standard for production
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 5000
      # Secrets — set values in the Render dashboard:
      - key: MONGODB_URI
        sync: false         # MongoDB Atlas connection string
      - key: JWT_ACCESS_SECRET
        sync: false
      - key: JWT_REFRESH_SECRET
        sync: false
      - key: CORS_ORIGIN
        sync: false         # your frontend Render URL
      - key: FRONTEND_URL
        sync: false         # your frontend Render URL
      - key: ML_SERVICE_URL
        sync: false         # your ml-service Render URL
      - key: EMAIL_PROVIDER
        value: smtp
      - key: SMTP_HOST
        sync: false
      - key: SMTP_PORT
        value: 587
      - key: SMTP_USER
        sync: false
      - key: SMTP_PASS
        sync: false
      - key: EMAIL_FROM_ADDRESS
        value: noreply@careerai.com
      - key: EMAIL_FROM_NAME
        value: CareerAI
      - key: OPENAI_API_KEY
        sync: false
      - key: LLM_PROVIDER
        value: openai
      - key: LLM_MODEL
        value: gpt-4o-mini
      - key: STRIPE_SECRET_KEY
        sync: false
      - key: STRIPE_WEBHOOK_SECRET
        sync: false
      - key: STRIPE_PRO_PRICE_ID
        sync: false
      - key: STRIPE_ENTERPRISE_PRICE_ID
        sync: false

  # ----------------------------------------------------------------
  # Frontend (Next.js)
  # ----------------------------------------------------------------
  - type: web
    name: career-ai-frontend
    runtime: docker
    dockerfilePath: ./frontend/Dockerfile
    dockerContext: ./frontend
    plan: free
    healthCheckPath: /
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3000
      - key: HOSTNAME
        value: "0.0.0.0"
      # Set in dashboard:
      - key: NEXT_PUBLIC_API_URL
        sync: false         # https://career-ai-backend.onrender.com/api/v1

  # ----------------------------------------------------------------
  # ML Service (Python / FastAPI)
  # ----------------------------------------------------------------
  - type: web
    name: career-ai-ml
    runtime: docker
    dockerfilePath: ./ml-service/Dockerfile
    dockerContext: ./ml-service
    plan: free
    healthCheckPath: /health
    envVars:
      - key: PYTHONUNBUFFERED
        value: "1"
      - key: PORT
        value: 8000
